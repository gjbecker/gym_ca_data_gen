import numpy as np
import pickle as pkl
import pprint
import matplotlib.pyplot as plt
import matplotlib.cm as cm
import sys, os

RES = 512
side = 18
agent_r = 2
goal_r = 0.2
scale = {
    'empty': 0,
    'ego agent': 1,
    'other agents': 2,
    'ego goal': 3
}

empty_grid = np.zeros((RES,RES))
# mid = int((RES-1)/2)

def draw(grid, x_coord, y_coord, rad, value, print_grid=False):
    # Coordinate transformation
    cx = (side+x_coord) * ((RES-1))/(side*2)
    cy = (side-y_coord) * ((RES-1))/(side*2)
    r = rad*((RES-1))/(side*2)

    if cx > RES-1 or cy > RES-1:
        print(f'{x_coord,y_coord} outside coordinate range!')
        return grid

    for angle in np.arange(0, 2*np.pi, np.pi/100):
        x = int(round(cx + r*np.cos(angle)))
        y = int(round(cy + r*np.sin(angle)))
        # print(x,y, angle)
        x = max(min(RES-1, x), 0)
        y = max(min(RES-1, y), 0)

        # Fill circle
        if np.pi/2 >= angle >= 0:
            for i in range(int(cx), x+1):
                for j in range(int(cy), y+1):
                    grid[j,i] = value

        elif np.pi >= angle >= np.pi/2:
            for i in range(x, int(cx)+1):
                for j in range(int(cy), y+1):
                    grid[j,i] = value

        elif 3*np.pi/2 >= angle >= np.pi:
            for i in range(x, int(cx)+1):
                for j in range(y, int(cy)+1):
                    grid[j,i] = value

        elif 2*np.pi >= angle >= 3*np.pi/2:
            for i in range(int(cx), x+1):
                for j in range(y, int(cy)+1):
                    grid[j,i] = value        

    # grid[int(cy)][int(cx)] = 9     # Mark center of circle

    if print_grid:
        print(grid)
        print('------------------------------------------------------')
    return grid

episodes = [[{'step': 1,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.629472847441819],
              [([1.01359904, 3.7913022 ]),
               1.049312700721057]],
   'actions': [([ 0.        , -0.52359879]),
               ([ 0.        , -0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 2,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.7806068466702967],
              [([1.01359904, 3.7913022 ]),
               0.6827618975365477]],
   'actions': [([ 0.93476582, -0.151134  ]),
               ([ 0.35085759, -0.3665508 ])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 3,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.2570080565015345],
              [([1.01359904, 3.7913022 ]),
               1.20636068770531]],
   'actions': [([0.        , 0.52359879]),
               ([0.        , 0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 4,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.7434547947446375],
              [([1.01359904, 3.7913022 ]),
               0.6827618975365477]],
   'actions': [([ 0.97612619, -0.48644674]),
               ([ 0.        , -0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 5,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.2198560045758753],
              [([1.01359904, 3.7913022 ]),
               1.20636068770531]],
   'actions': [([0.        , 0.52359879]),
               ([0.        , 0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 6,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.7121274577180414],
              [([1.01359904, 3.7913022 ]),
               0.6827618975365477]],
   'actions': [([ 1.0062449 , -0.49227145]),
               ([ 0.        , -0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 7,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.188528667549279],
              [([1.01359904, 3.7913022 ]),
               1.20636068770531]],
   'actions': [([0.        , 0.52359879]),
               ([0.        , 0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 8,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.6790019677678614],
              [([1.01359904, 3.7913022 ]),
               0.6827618975365477]],
   'actions': [([ 1.03680778, -0.4904733 ]),
               ([ 0.        , -0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 9,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.155403177599099],
              [([1.01359904, 3.7913022 ]),
               1.20636068770531]],
   'actions': [([0.        , 0.52359879]),
               ([0.        , 0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 10,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.644060234884408],
              [([1.01359904, 3.7913022 ]),
               0.6827618975365477]],
   'actions': [([ 1.06770146, -0.48865706]),
               ([ 0.        , -0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 11,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.120461444715646],
              [([1.01359904, 3.7913022 ]),
               1.20636068770531]],
   'actions': [([0.        , 0.52359879]),
               ([0.        , 0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 12,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.60728139744201],
              [([1.01359904, 3.7913022 ]),
               0.6827618975365477]],
   'actions': [([ 1.09879351, -0.48681995]),
               ([ 0.        , -0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 13,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0836826072732477],
              [([1.01359904, 3.7913022 ]),
               1.20636068770531]],
   'actions': [([0.        , 0.52359879]),
               ([0.        , 0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 14,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.568655590871957],
              [([1.01359904, 3.7913022 ]),
               0.6827618975365477]],
   'actions': [([ 1.12992573, -0.48497298]),
               ([ 0.        , -0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 15,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536492870847254],
              [([1.01359904, 3.7913022 ]),
               1.20636068770531]],
   'actions': [([1.40414572, 0.5150063 ]),
               ([0.        , 0.52359879])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 16,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649329668255],
              [([1.01359904, 3.7913022 ]),
               1.582475324364932]],
   'actions': [([ 1.40414572e+00, -4.25835296e-08]),
               ([1.74893034, 0.37611464])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 17,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493085295446],
              [([1.01359904, 3.7913022 ]),
               1.58247535587201]],
   'actions': [([1.40414560e+00, 2.11387103e-08]),
               ([1.74893022e+00, 3.15070778e-08])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 18,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649308529543],
              [([1.01359904, 3.7913022 ]),
               1.5824753423772473]],
   'actions': [([1.40414572e+00, 1.77635684e-15]),
               ([ 1.74893034e+00, -1.34947626e-08])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 19,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493085295446],
              [([1.01359904, 3.7913022 ]),
               1.5824753423772469]],
   'actions': [([ 1.40414572e+00, -1.77635684e-15]),
               ([ 1.74893022e+00, -4.44089210e-16])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 20,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493085295446],
              [([1.01359904, 3.7913022 ]),
               1.5824753423772469]],
   'actions': [([1.40414572, 0.        ]),
               ([1.74893034, 0.        ])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 21,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536494965095797],
              [([1.01359904, 3.7913022 ]),
               1.5824753423772473]],
   'actions': [([ 1.40414584e+00, -1.87980035e-07]),
               ([1.74893022e+00, 4.44089210e-16])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 22,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649496509578],
              [([1.01359904, 3.7913022 ]),
               1.5824753503376343]],
   'actions': [([1.40414584e+00, 1.77635684e-15]),
               ([1.74892914e+00, 7.96038702e-09])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 23,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649496509578],
              [([1.01359904, 3.7913022 ]),
               1.5824753503376354]],
   'actions': [([1.40414584, 0.        ]),
               ([1.74892902e+00, 1.11022302e-15])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 24,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536498906985083],
              [([1.01359904, 3.7913022 ]),
               1.5824753503376356]],
   'actions': [([ 1.40414476e+00, -3.94188930e-07]),
               ([1.74892914e+00, 2.22044605e-16])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 25,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536498906984924],
              [([1.01359904, 3.7913022 ]),
               1.5824753503376354]],
   'actions': [([1.40414476e+00, 1.59872116e-14]),
               ([ 1.74892914e+00, -2.22044605e-16])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 26,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536498906984977],
              [([1.01359904, 3.7913022 ]),
               1.5824753503376352]],
   'actions': [([ 1.40414476e+00, -5.32907052e-15]),
               ([ 1.74892902e+00, -2.22044605e-16])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 27,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536498906984977],
              [([1.01359904, 3.7913022 ]),
               1.5824753503376354]],
   'actions': [([1.40414476, 0.        ]),
               ([1.74892914e+00, 2.22044605e-16])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 28,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536498906984995],
              [([1.01359904, 3.7913022 ]),
               1.5824753503376352]],
   'actions': [([ 1.40414488e+00, -1.77635684e-15]),
               ([ 1.74892902e+00, -2.22044605e-16])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 29,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536498906984977],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414476e+00, 1.77635684e-15]),
               ([1.74892914e+00, 6.81566576e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 30,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381717],
              [([1.01359904, 3.7913022 ]),
               1.5824753503375784]],
   'actions': [([1.40414453e+00, 3.75960326e-07]),
               ([ 1.74892902e+00, -6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 31,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381983],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414441e+00, -2.66453526e-14]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 1.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 32,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493176437616],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414512e+00, 1.97094437e-07]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 33,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.05364931764376],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414500e+00, 1.77635684e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 34,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493176437562],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414500e+00, 3.55271368e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 35,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649317643758],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414500e+00, -1.77635684e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 36,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493176437562],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414512e+00, 1.77635684e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 37,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536494161909604],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414476e+00, -9.85472042e-08]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 38,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536494161909533],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414476e+00, 7.10542736e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 39,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493915541505],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414476e+00, 2.46368028e-08]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 40,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493915541523],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414488e+00, -1.77635684e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 41,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493669173512],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414488e+00, 2.46368010e-08]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 42,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649416190957],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414476e+00, -4.92736056e-08]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 43,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536494161909533],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414476e+00, 3.55271368e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 44,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536493176437562],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414500e+00, 9.85471971e-08]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 45,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.05364931764376],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414512e+00, -3.55271368e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 46,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649317643758],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414500e+00, 1.77635684e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 47,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649317643758],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.404145, 0.      ]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 48,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649317643758],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.404145, 0.      ]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 49,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381806],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414453e+00, -1.97094423e-07]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 50,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381966],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414453e+00, -1.59872116e-14]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 51,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381895],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414453e+00, 7.10542736e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 52,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381895],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414453, 0.        ]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 53,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381895],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414441, 0.        ]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 54,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381912],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414453e+00, -1.77635684e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 55,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381895],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414453e+00, 1.77635684e-15]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 56,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536495147381895],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414453, 0.        ]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 57,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649120549458],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414548e+00, 3.94188731e-07]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 58,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536491205494847],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414560e+00, -2.66453526e-14]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 59,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053649908927459],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414345e+00, -7.88377974e-07]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 60,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536491205494847],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414560e+00, 7.88377974e-07]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 61,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.053651412768763],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414453e+00, -2.29221928e-06]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 62,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536514127686263],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414453e+00, 1.36779477e-13]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 63,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536491205495753],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414560e+00, 2.29221905e-06]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 64,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536506243889465],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414667e+00, -1.50383937e-06]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 65,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.0536491205494616],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([1.40414560e+00, 1.50383948e-06]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([0., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']},
  {'step': 66,
   'agents': [0,
              1],
   'radius': [0.6291136198234517,
              0.21213103846419545],
   'states': [[([-3.47435904, -3.28604818]),
               -2.05365141276874],
              [([1.01359904, 3.7913022 ]),
               1.5824760319042108]],
   'actions': [([ 1.40414453e+00, -2.29221928e-06]),
               ([1.74892914e+00, 6.81566632e-07])],
   'rewards': ([1., 0.]),
   'goals': [([-3.53569583, -3.40304876]),
             ([1.0129821 , 3.84412466])],
   'policies': ['RVOPolicy',
                'RVOPolicy']}]]

# Read data
path = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'datasets')
                    # '{policy}_{num_agents}_agent_{num_episodes}.pkl'.format(policy='mixed', num_agents='2', num_episodes='10000'))
# file = open(path, 'rb')
# episodes = pkl.load(file)
files = os.listdir(path)
for file in files:
    if file.endswith('.pkl'):
        pass
    else:
        files.remove(file)

# Main loop
for file in files:
    print(file)
    data = open(os.path.join(path, file), 'rb')
    episodes = pkl.load(data)
    for episode in episodes:
        agents = episode[0]['agents']
        radii = episode[0]['radii']
        goals = episode[0]['goals']

        # Cycle through each agent as ego for all episodes
        for ego in range(len(agents)):      
            # Draw goal for ego agent
            print(goals[ego])
            grid_goal = draw(np.copy(empty_grid), goals[ego][0], goals[ego][1], goal_r, scale['ego goal'])
            print(f'Goal ego:{ego}, {goals[ego]}')
            
            for step in episode:
                print(step['step'])
                grid = np.copy(grid_goal)
                states = step['states']
                # Draw positions for agents
                for agent in agents:
                    print(f'Agent {agent}; State: {states[agent][0]}')
                    if agent == ego:
                        grid = draw(grid, states[agent][0][0], states[agent][0][1], radii[agent], scale['ego agent'])
                    else:
                        grid = draw(grid, states[agent][0][0], states[agent][0][1], radii[agent], scale['other agents'])
                if step['step'] % 10 == 0:
                    plt.imshow(grid, cmap=cm.gray)
                    plt.show()
        print('New Episode')
